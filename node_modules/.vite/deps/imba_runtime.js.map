{
  "version": 3,
  "sources": ["../../imba/src/imba/runtime.mjs"],
  "sourcesContent": ["export const __init__$  = Symbol.for('#__init__')\nexport const __initor__$\t = Symbol.for('#__initor__')\nexport const __inited__$\t = Symbol.for('#__inited__')\nexport const __hooks__$\t = Symbol.for('#__hooks__')\nexport const __patch__$\t = Symbol.for('#__patch__')\nexport const __has__$\t = Symbol.for('#has')\nexport const __meta__$\t = Symbol.for('#meta')\nexport const __imba__$\t = Symbol.for('imba')\nexport const __mixin__$\t = Symbol.for('#__mixin__')\nexport const matcher = Symbol.for('#matcher')\n\nexport const appendChild$\t = Symbol.for('#appendChild')\nexport const afterVisit$\t = Symbol.for('#afterVisit')\nexport const beforeReconcile$\t = Symbol.for('#beforeReconcile')\nexport const afterReconcile$\t = Symbol.for('#afterReconcile')\nexport const up$\t = Symbol.for('##up')\n\nexport const HAS = {\n\tSUPERCALLS: 1 << 3,\n\tCONSTRUCTOR: 1 << 4\n}\n\nexport const ClassFlags = {\n\tIsExtension: 1 << 0,\n\tIsTag: 1 << 1,\n\tHasDescriptors: 1 << 2,\n\tHasSuperCalls: 1 << 3,\n\tHasConstructor: 1 << 4,\n\tHasFields: 1 << 5,\n\tHasMixins: 1 << 6,\n\tHasInitor: 1 << 7,\n\tHasDecorators: 1 << 8,\n\tIsObjectExtension: 1 << 9\n}\n\nconst mmap = new Map;\n\nconst state = globalThis[__imba__$] ||= {\n\tcounter: 0,\n\tclasses: mmap\n};\n\nfunction meta$(klass,defaults = {}){\n\tmmap.has(klass) || mmap.set(klass,{\n\t\tsymbol: Symbol(),\n\t\tparent: Object.getPrototypeOf(klass.prototype)?.constructor,\n\t\tfor:klass,\n\t\tuses:[],\n\t\tinits:[],\n\t\tid: state.counter++,\n\t\t...defaults\n\t});\n\treturn mmap.get(klass)\n}\n\nconst statics = new WeakMap;\n\nconst L = function(){ }\n\nexport function is$(a,b){\n\treturn a === b || b?.[matcher]?.(a);\n};\n\nexport function isa$(a,b){\n\treturn (typeof b === 'string') ? (typeof a === b) : b?.[Symbol.hasInstance]?.(a);\n};\n\nexport function has$(a,b){\t\n\treturn ((b?.[__has__$]?.(a) ?? b?.includes?.(a) ?? b?.has?.(a)) ?? false);\n}\n\nexport function idx$(a,b){\n\treturn b?.indexOf ? b.indexOf(a) : Array.prototype.indexOf.call(a,b);\n}\n\nexport function statics$(scope){\n\treturn statics.get(scope) || statics.set(scope,{}).get(scope);\n}\n\n// $1 extends {$accessor: (...args: any[]) => infer X} ? X : $1\nexport function iterable$(a){\n\treturn a?.toIterable?.() || a;\n}\n\nexport function decorate$(ds,t,k,desc){\n\tlet d,c = arguments.length,i = ds.length;\n\tlet r = (c < 3) ? t : (((desc === null) ? (desc = Object.getOwnPropertyDescriptor(t,k)) : desc));\n\twhile (i > 0){\n\t\tif (d = ds[--i]) { r = (c < 3 ? d(r) : (c > 3 ? d(t,k,r) : d(t,k))) || r };\n\t};\n\tc > 3 && r && Object.defineProperty(t,k,r);\n\treturn r;\n}\n\nfunction isSameDesc(a,b){\n\tif(!a || !b) return false;\n\tif(a.get) return b.get === a.get;\n\tif(a.set) return b.set === a.set;\n\tif(a.value) return a.value === b.value;\n}\n\nexport function extend$(target,ext,descs){\n\tconst klass = target.constructor;\n\tdescs ??= Object.getOwnPropertyDescriptors(ext);\n\tconst originals = Object.getOwnPropertyDescriptors(target);\n\tdelete descs.constructor;\n\n\tif (descs[__init__$]) {\n\t\t// console.warn(`Cannot define plain fields when extending class ${klass.name}`);\n\t\tdelete descs[__init__$];\n\t};\n\n\tObject.defineProperties(target,descs);\n\n\tlet meta = meta$(klass);\n\tif(meta && meta.augments){\n\t\tfor(let target of meta.augments){\n\t\t\tlet current = Object.getOwnPropertyDescriptors(target.prototype);\n\t\t\tlet defines = {}\n\t\t\tfor(let key of Object.keys(descs)){\n\t\t\t\tlet prop = descs[key];\n\t\t\t\tif(current[key] && !isSameDesc(originals[key],current[key])) console.warn('wont extend',key);\n\t\t\t\telse defines[key] = prop;\n\t\t\t}\n\n\t\t\tif(Object.keys(defines).length) extend$(target.prototype,null,defines)\n\t\t}\n\t}\n\n\treturn target;\n}\n\n\n\nexport function augment$(klass,mixin){\n\tlet meta = meta$(klass);\n\tlet mix = meta$(mixin);\n\t\n\tif(mix.parent){\n\t\tif(!(klass.prototype instanceof mix.parent)){\n\t\t\t// For better error reports we could delay this message...\n\t\t\tthrow new Error(`Mixin ${mix.name} has superclass not present in target class`);\n\t\t}\n\t}\n\n\tif(!mix.augments){\n\t\tmix.augments = new Set;\n\t\tconst ref = mix.ref = Symbol();\n\t\tconst native = Object[Symbol.hasInstance];\n\t\tmixin.prototype[ref] = true;\n\t\tObject.defineProperty(mixin,Symbol.hasInstance,{\n\t\t\tvalue: function(rel) { return (this === mixin) ? (rel && !!rel[ref]) : native.call(this,rel) }\n\t\t})\n\t}\n\t\n\t// klass already contains mixin somewhere in the chain\n\tif(klass.prototype[mix.ref]){\n\t\treturn klass;\n\t}\n\n\tfor(let v of mix.uses) augment$(klass,v,meta);\n\n\tmix.augments.add(klass);\n\tmeta.uses.push(mixin);\n\n\tlet descs = Object.getOwnPropertyDescriptors(mixin.prototype);\n\tdelete descs.constructor\n\n\tif(descs[__init__$]){\n\t\tmeta.inits.push(mixin.prototype[__init__$]);\n\t\tdelete descs[__init__$];\n\t}\n\n\tObject.defineProperties(klass.prototype,descs);\n\t// TODO Should also run a method / trigger a hook\n\ttry { meta.top.version++; } catch(e) { }\n\treturn klass;\n};\n\nexport function multi$(symbol,sup,...mixins){\t\n\tlet Mixins = sup ? (class extends sup {}) : (class {});\n\tlet meta = meta$(Mixins,{symbol});\n\n\tfor(let mixin of mixins) augment$(Mixins,mixin);\n\n\tMixins.prototype[symbol] = function(o,deep,fields) {\n\t\tif(meta.inits)\n\t\t\tfor(let init of meta.inits){ init.call(this,o,false,fields) }\n\t\treturn\n\t};\n\t\n\treturn Mixins\n};\n\nlet sup = {\n\tcache: {},\n\tself: null,\n\ttarget: null,\n\tproxy: new Proxy({},{\n\t\tapply: (_, key, ...params) => {\n\t\t\treturn sup.target[key].apply(sup.self, params)\n\t\t},\n\t\tget: (_, key) => {\n\t\t\treturn Reflect.get(sup.target, key, sup.self);\n\t\t},\n\t\tset: (_, key, value, receiver) => {\n\t\t\treturn Reflect.set(sup.target, key, value, sup.self);\n\t\t}\n\t})\n}\n\nexport function sup$(self,symbol) {\n\tsup.self = self;\n\tsup.target = sup.cache[symbol];\n\treturn sup.proxy;\n}\n\nexport function register$(klass,symbol,name,flags,into = null) {\n\t// Look for the actual superclass excluding mixins\n\tlet proto = Object.getPrototypeOf(klass.prototype)\n\tif(flags & ClassFlags.HasMixins) {\n\t\tmmap.set(klass,mmap.get(proto.constructor))\n\t\tproto = Object.getPrototypeOf(proto)\n\t}\n\n\tif(into){\n\t\tlet target = flags & ClassFlags.IsObjectExtension ? into : into.prototype;\n\t\tlet meta = meta$(klass);\n\n\t\tif(meta.uses?.length){\n\t\t\tif(into === target) console.warn(\"Cannot extend object with mixins\");\n\t\t\tfor(let mixin of meta.uses) augment$(into,mixin);\n\t\t}\n\t\t// Create fake super now\n\t\tif(flags & ClassFlags.HasSuperCalls){\n\t\t\tsup.cache[symbol] = Object.create(\n\t\t\t\tObject.getPrototypeOf(target),\n\t\t\t\tObject.getOwnPropertyDescriptors(target)\n\t\t\t)\n\t\t}\n\n\t\textend$(target,klass.prototype);\n\t\treturn into;\n\t}\n\n\tlet supr = proto?.constructor;\n\tlet meta = meta$(klass,{symbol})\n\n\t// Override name of class\n\tif(name && klass.name !== name){\n\t\tObject.defineProperty(klass,\"name\",{value: name,configurable: true})\n\t}\n\tmeta.flags = flags;\n\n\tif(flags & ClassFlags.HasConstructor)\n\t\tklass.prototype[__initor__$] = symbol;\n\n\tif(supr?.inherited instanceof Function) supr.inherited(klass)\n\treturn klass;\n}\n\nexport function inited$(obj,symbol){\n\tif(obj[__initor__$]===symbol){\n\t\t// init potential hooks\n\t\tobj[__inited__$]?.();\n\t\tobj[__hooks__$]&&obj[__hooks__$].inited(obj);\n\t}\n}\n"],
  "mappings": "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",
  "names": ["target", "sup", "meta"]
}
